# filebeat-logstash

## Architecture
![filebeat-logstash-architecture](https://user-images.githubusercontent.com/59144753/212483412-783e0f0f-83d0-40aa-9477-31a4b9b34883.png)


**logs** : Generated by EC2 and are input for filebeat
**FileBeat** : Filebeat is a lightweight shipper for forwarding and centralizing log data. Installed as an agent on the ec2 instance
**Logstash** : Logstash is a free and open server-side data processing pipeline that ingests data from filbeat and sends it to Opensearch

## To update EC2 machine 
### Install Filebeat
1. Download the RPM for the desired version of Filebeat:
```bash
wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-oss-7.16.2-x86_64.rpm
```
2. Install the Filebeat RPM file:
```bash
rpm -ivh filebeat-oss-7.16.2-x86_64.rpm
```
### Install Logstash

Download the RPM file of the desired Logstash version:
```bash
wget https://artifacts.elastic.co/downloads/logstash/logstash-oss-7.16.2-x86_64.rpm
```
stall Java or OpenJDK on your EC2 instance before installing Logstash RPM file:
```bash
yum install java-1.8.0-*	
```
After Java install, install the RPM file that you downloaded for Logstash using the rpm command:
```bash
rpm -ivh logstash-oss-7.16.2-x86_64.rpm
```
## install opensearch plugin
```bash
sudo /usr/share/logstash/bin/logstash-plugin install logstash-output-opensearch
```
## Configure filebeat : 
Change output to : 
```bash
sudo nano /etc/filebeat/filebeat.yaml
```
```yaml
Output.logstash: 
  Hosts: [â€œlocalhost:5044â€]
  index: mentor-china
```
## configure Logstash
in 
```bash
nano /etc/logstash/conf.d/logstash.conf
```

```yaml
output {
  opensearch {
    hosts => ["your-endpoint"]
    index => "mentor-china-%{[fields][type]}-%{+YYYY.MM.dd}"
    ecs_compatibility => disabled
  }
}
```
